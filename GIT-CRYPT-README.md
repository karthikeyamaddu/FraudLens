# ğŸ” Git-Crypt Guide for CipherCop 2025

## ğŸ“‹ Table of Contents
- [Overview](#overview)
- [What We Accomplished](#what-we-accomplished)
- [File Structure](#file-structure)
- [Installation Process](#installation-process)
- [Important Commands](#important-commands)
- [How Encryption Works](#how-encryption-works)
- [Team Collaboration Workflow](#team-collaboration-workflow)
- [Troubleshooting](#troubleshooting)
- [Security Best Practices](#security-best-practices)

---

## ğŸ¯ Overview

Git-crypt is a transparent file encryption tool for git repositories. It allows us to store sensitive files (like `.env` files containing API keys) securely in our git repository while keeping the rest of the code readable.

### ğŸ”‘ Key Benefits:
- **Selective Encryption**: Only encrypts specified files (our `.env` files)
- **Transparent Operation**: Encrypted files appear normal when repository is unlocked
- **Team Collaboration**: Secure key sharing for authorized team members
- **Git Integration**: Works seamlessly with normal git workflows

---

## âœ… What We Accomplished

### 1. **Git-Crypt Installation (WSL-based)**
- Installed git-crypt in Windows Subsystem for Linux (WSL)
- Created a Windows wrapper (`C:\git-crypt\git-crypt.bat`) to use WSL version natively in cmd
- Added `C:\git-crypt` to PATH for easy access

### 2. **Environment File Security Setup**
- Created `.gitattributes` file to specify which files to encrypt
- Configured encryption for **ONLY** the 4 `.env` files:
  - `backend/.env`
  - `backend_py/clone-detection/combined-analysis/.env`
  - `backend_py/clone-detection/gemini/.env`
  - `backend_py/phishing-detection/.env`

### 3. **Backup System**
- Created `create_env_backups.py` script to generate `env.txt` backups
- Automatically masks sensitive values in output
- Processes all 4 environment files

### 4. **Setup Automation**
- Created `setup-git-crypt.bat` for easy initialization
- Generated encryption key: `ciphercop-git-crypt.key`
- Configured git repository for encryption

### 5. **Documentation**
- Created `.env.example` files for all services as public templates
- Comprehensive documentation in `ENV-SECURITY-README.md`
- This detailed git-crypt guide

---

## ğŸ“ File Structure

```
ciphercopdemo/
â”œâ”€â”€ ğŸ” Git-Crypt Files
â”‚   â”œâ”€â”€ .gitattributes                    # Encryption configuration
â”‚   â”œâ”€â”€ ciphercop-git-crypt.key          # ğŸ”‘ Encryption key (KEEP SECURE!)
â”‚   â”œâ”€â”€ setup-git-crypt.bat              # Setup automation script
â”‚   â”œâ”€â”€ create_env_backups.py            # Backup generation script
â”‚   â””â”€â”€ GIT-CRYPT-README.md              # This guide
â”‚
â”œâ”€â”€ ğŸ”’ Encrypted Files (.env files)
â”‚   â”œâ”€â”€ backend/.env                      # ğŸ”’ ENCRYPTED
â”‚   â”œâ”€â”€ backend_py/clone-detection/
â”‚   â”‚   â”œâ”€â”€ combined-analysis/.env        # ğŸ”’ ENCRYPTED
â”‚   â”‚   â””â”€â”€ gemini/.env                   # ğŸ”’ ENCRYPTED
â”‚   â””â”€â”€ backend_py/phishing-detection/.env # ğŸ”’ ENCRYPTED
â”‚
â”œâ”€â”€ ğŸ“„ Public Templates (.env.example files)
â”‚   â”œâ”€â”€ backend/.env.example              # âœ… Public template
â”‚   â”œâ”€â”€ backend_py/clone-detection/
â”‚   â”‚   â”œâ”€â”€ combined-analysis/.env.example # âœ… Public template
â”‚   â”‚   â””â”€â”€ gemini/.env.example           # âœ… Public template
â”‚   â””â”€â”€ backend_py/phishing-detection/.env.example # âœ… Public template
â”‚
â””â”€â”€ ğŸ“ Backup Files (generated by script)
    â”œâ”€â”€ backend/env.txt
    â”œâ”€â”€ backend_py/clone-detection/
    â”‚   â”œâ”€â”€ combined-analysis/env.txt
    â”‚   â””â”€â”€ gemini/env.txt
    â””â”€â”€ backend_py/phishing-detection/env.txt
```

---

## âš™ï¸ Installation Process

### **Step 1: WSL Setup**
```cmd
# Check WSL availability
wsl --version

# Install git-crypt in WSL
wsl sudo apt-get update
wsl sudo apt-get install -y git-crypt
```

### **Step 2: Windows Integration**
```cmd
# Create git-crypt directory
mkdir C:\git-crypt

# Copy wrapper script (done automatically)
copy git-crypt.bat "C:\git-crypt\git-crypt.bat"

# Add to PATH (temporary for session)
set "PATH=%PATH%;C:\git-crypt"
```

### **Step 3: Repository Setup**
```cmd
# Run automated setup
setup-git-crypt.bat

# Or manual setup:
git-crypt init
git-crypt export-key ciphercop-git-crypt.key
```

---

## ğŸ’» Important Commands

### **Basic Commands**
```cmd
# Check git-crypt version
git-crypt --version

# Check encryption status of files
git-crypt status

# Initialize git-crypt in repository
git-crypt init

# Export encryption key
git-crypt export-key ciphercop-git-crypt.key
```

### **Lock/Unlock Commands**
```cmd
# Unlock encrypted files (for new team members)
git-crypt unlock ciphercop-git-crypt.key

# Lock files (optional - files auto-encrypt on commit)
git-crypt lock

# Check if repository is locked or unlocked
git-crypt status
```

### **Backup Commands**
```cmd
# Create env.txt backups from all .env files
python create_env_backups.py

# Check backup files were created
dir backend\env.txt
dir backend_py\clone-detection\combined-analysis\env.txt
dir backend_py\clone-detection\gemini\env.txt
dir backend_py\phishing-detection\env.txt
```

### **Git Integration Commands**
```cmd
# Normal git workflow - files auto-encrypt on commit
git add .
git commit -m "Update environment configuration"
git push

# Files are automatically encrypted when committed
# Files are automatically decrypted when repository is unlocked
```

---

## ğŸ” How Encryption Works

### **Configuration File: `.gitattributes`**
```properties
# Specifies which files to encrypt
backend/.env filter=git-crypt diff=git-crypt
backend_py/clone-detection/combined-analysis/.env filter=git-crypt diff=git-crypt
backend_py/clone-detection/gemini/.env filter=git-crypt diff=git-crypt
backend_py/phishing-detection/.env filter=git-crypt diff=git-crypt
```

### **Encryption Process**
1. **When you commit**: Git-crypt automatically encrypts specified files before storing in repository
2. **When others clone**: Encrypted files appear as binary data until unlocked
3. **When unlocked**: Files appear as normal text files in working directory
4. **Algorithm**: Uses AES-256 encryption for maximum security

### **What Gets Encrypted vs Not Encrypted**

| File Type | Status | Reason |
|-----------|--------|---------|
| `.env` files | ğŸ”’ **ENCRYPTED** | Contains API keys, secrets |
| `.env.example` files | âœ… **NOT ENCRYPTED** | Public templates |
| Source code (`.py`, `.js`, etc.) | âœ… **NOT ENCRYPTED** | Should be readable |
| Documentation (`.md`) | âœ… **NOT ENCRYPTED** | Public information |
| Configuration files | âœ… **NOT ENCRYPTED** | Unless they contain secrets |

---

## ğŸ‘¥ Team Collaboration Workflow

### **For Repository Owner (Initial Setup)**
```cmd
# 1. Setup git-crypt (already done)
setup-git-crypt.bat

# 2. Add encrypted files to git
git add .gitattributes
git add backend/.env
git add backend_py/clone-detection/combined-analysis/.env
git add backend_py/clone-detection/gemini/.env
git add backend_py/phishing-detection/.env
git commit -m "Add encrypted environment files"
git push

# 3. Share key securely with team members
# Send ciphercop-git-crypt.key via encrypted email or secure file sharing
```

### **For New Team Members**
```cmd
# 1. Clone the repository
git clone https://github.com/Samith-P/ciphercopdemo.git
cd ciphercopdemo

# 2. Setup git-crypt on their machine
# Install WSL and git-crypt (same process as above)

# 3. Unlock encrypted files using shared key
git-crypt unlock ciphercop-git-crypt.key

# 4. Verify files are decrypted
git-crypt status
type backend\.env  # Should show actual content, not binary data

# 5. Create backups if needed
python create_env_backups.py
```

### **For Daily Development**
```cmd
# Normal git workflow - encryption is transparent
git add .
git commit -m "Your changes"
git push

# Files automatically encrypt on commit
# Files automatically decrypt when repository is unlocked
```

---

## ğŸš¨ Troubleshooting

### **Problem: "git-crypt: command not found"**
```cmd
# Solution: Add to PATH
set "PATH=%PATH%;C:\git-crypt"

# Or check if WSL git-crypt is installed
wsl git-crypt --version
```

### **Problem: "This repository has already been initialized"**
```cmd
# This is normal - git-crypt is already setup
# Just export the key if needed
git-crypt export-key ciphercop-git-crypt.key
```

### **Problem: Files showing as binary data**
```cmd
# Repository is locked - unlock it
git-crypt unlock ciphercop-git-crypt.key

# Check status
git-crypt status
```

### **Problem: Permission denied**
```cmd
# Run command prompt as Administrator
# Or check file permissions on key file
```

### **Problem: WSL not available**
```cmd
# Enable WSL in Windows Features
# Or download pre-compiled git-crypt binary for Windows
```

---

## ğŸ›¡ï¸ Security Best Practices

### **ğŸ”‘ Key Management**
- âœ… **Store key in multiple secure locations** (encrypted drives, secure cloud storage)
- âœ… **Share key only through encrypted channels** (ProtonMail, Signal, encrypted USB)
- âœ… **Never commit key to repository** (it's in .gitignore)
- âœ… **Rotate keys periodically** for enhanced security
- âœ… **Limit key access** to authorized team members only

### **ğŸ”’ Repository Security**
- âœ… **Verify .gitattributes** is committed and properly configured
- âœ… **Test encryption** by cloning repository without key
- âœ… **Monitor repository access** and key distribution
- âœ… **Use strong git authentication** (SSH keys, 2FA)

### **ğŸ“± Team Practices**
- âœ… **Document who has keys** and when they were shared
- âœ… **Revoke access** by generating new keys when needed
- âœ… **Train team members** on proper key handling
- âœ… **Regular security audits** of encrypted files

---

## ğŸ“š Quick Reference

### **Essential Files**
| File | Purpose | Action Required |
|------|---------|-----------------|
| `ciphercop-git-crypt.key` | ğŸ”‘ Encryption key | Keep secure, share with team |
| `.gitattributes` | ğŸ“ Encryption config | Commit to repository |
| `setup-git-crypt.bat` | âš™ï¸ Setup automation | Run once per machine |
| `create_env_backups.py` | ğŸ’¾ Backup generator | Run when needed |

### **Quick Commands Cheat Sheet**
```cmd
# Setup (one-time)
setup-git-crypt.bat

# Daily use
python create_env_backups.py  # Create backups
git-crypt status              # Check encryption status

# Team member onboarding
git-crypt unlock ciphercop-git-crypt.key

# Emergency
git-crypt lock                # Lock all files
git-crypt unlock ciphercop-git-crypt.key  # Unlock again
```

---

## ğŸ¯ Summary

We successfully implemented a robust environment file security system that:

1. **ğŸ”’ Encrypts sensitive `.env` files** containing API keys and secrets
2. **ğŸ“‚ Keeps code readable** - only environment files are encrypted
3. **ğŸ¤ Enables secure team collaboration** through encrypted key sharing
4. **ğŸ”„ Provides backup functionality** with `env.txt` generation
5. **âš¡ Works transparently** with normal git workflows
6. **ğŸ›¡ï¸ Uses industry-standard AES-256 encryption**

Your sensitive data is now protected while maintaining full development workflow functionality! ğŸ‰

---

*For questions or issues, refer to this guide or check the `ENV-SECURITY-README.md` for additional details.*
